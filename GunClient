local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

local flySpeed = 5  -- Tốc độ mặc định
local maxFlySpeed = 50 -- Giới hạn tốc độ
local acceleration = 2  -- Tốc độ tăng dần

-- 🚀 Tạo BodyVelocity và BodyGyro
local bodyVelocity = Instance.new("BodyVelocity")
bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
bodyVelocity.Parent = humanoidRootPart

local bodyGyro = Instance.new("BodyGyro")
bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
bodyGyro.Parent = humanoidRootPart

humanoid.PlatformStand = true

RunService.RenderStepped:Connect(function()
    -- Giữ nhân vật thẳng với hướng camera
    bodyGyro.CFrame = workspace.CurrentCamera.CFrame

    -- Lấy hướng di chuyển và camera
    local cameraCF = workspace.CurrentCamera.CFrame
    local moveVector = humanoid.MoveDirection
    local lookVector = cameraCF.LookVector
    
    -- Tính toán vận tốc
    local velocity = Vector3.new(0, 0, 0)
    
    if moveVector.Magnitude > 0 then
        flySpeed = math.min(flySpeed + acceleration, maxFlySpeed)
        
        -- Tính dot product để xác định hướng di chuyển tương đối với camera
        local dotProduct = moveVector:Dot(lookVector)
        
        -- Áp dụng chuyển động ngang và dọc
        local verticalComponent = lookVector.Y * flySpeed * (dotProduct > 0 and 1 or -1)
        velocity = moveVector * flySpeed
        velocity = velocity + Vector3.new(0, verticalComponent, 0)
    else
        flySpeed = 5
    end
    
    bodyVelocity.Velocity = velocity
end)
